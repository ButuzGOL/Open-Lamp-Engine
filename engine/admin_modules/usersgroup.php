<?php/*
//=============================================================================/
// Open Lamp Engine version 1.0
//-----------------------------------------------------------------------------/
// Web-site: http://www.pamparam.net/ email: openlampengine@gmail.com
//-----------------------------------------------------------------------------/
// Author: r0n9.GOL email: ron9.gol@gmail.com
//-----------------------------------------------------------------------------/
// Copyright by r0n9.GOL © 2009
//=============================================================================/
// Данный код защищен авторскими правами :)
//=============================================================================/
// Файл: usersgroup.php
//-----------------------------------------------------------------------------/
// Назначение: Модуль управления группами пользователей (админка)
//=============================================================================/
*/    if (!defined("OLE")) die("<script>window.location = \"./\"</script>");		if ($USER_RIGHTS['id_ug']==1) {		
		include(CLASSES."/categories.class.php");
		
		$o_categories = new categories($o_mysql);
				$a  = $o_vars->get['a'];		$id = $o_vars->get['id'];						if ($a=="add") {			
			$sw = false;
				    	$action = $o_vars->post['action'];	    		        if (!isset($action)) {
	        	
	        	$mrules["{TITLEE}"] = $LANG[$m.'_fadd'];				
				$mrules["{GROUP_NAME}"] = "";
				$mrules["{IS_ADM}"]     = "";
				
				$mrules["{ALLOW_CATS_SEL}"] = "selected=\"selected\"";
				$mrules["{CAT_ADD_SEL}"]    = "selected=\"selected\"";
								
				$mrules["{ALLOW_CATS}"] = "";				$mrules["{CAT_ADD}"]    = "";
				$result = $o_categories->makeTree();	        	if ($result) 
	        		foreach ($result as $n) {
	        			$mrules["{CAT_ADD}"]    .= "<option value=\"$n[0]\">".$n[1]."</option>"; 
	        			$mrules["{ALLOW_CATS}"] .= "<option value=\"$n[0]\">".$n[1]."</option>";
	        		}
	        		
	        	$mrules["{ALLOW_OFFLINE_YES}"]    = "";				$mrules["{ALLOW_OFFLINE_NO}"]     = "checked=\"checked\"";				$mrules["{ALLOW_ADMIN_YES}"]      = "";				$mrules["{ALLOW_ADMIN_NO}"]       = "checked=\"checked\"";				$mrules["{ALLOW_SHORT_YES}"]      = "";				$mrules["{ALLOW_SHORT_NO}"]       = "checked=\"checked\"";				$mrules["{ALLOW_POLL_YES}"]       = "checked=\"checked\"";				$mrules["{ALLOW_POLL_NO}"]        = "";				$mrules["{ALLOW_ADDS_YES}"]       = "";				$mrules["{ALLOW_ADDS_NO}"]        = "checked=\"checked\"";				$mrules["{MODERATION_YES}"]       = "";				$mrules["{MODERATION_NO}"]        = "checked=\"checked\"";				$mrules["{ALLOW_MAIN_YES}"]       = "";				$mrules["{ALLOW_MAIN_NO}"]        = "checked=\"checked\"";				$mrules["{ALLOW_EDIT_YES}"] 	  = "";				$mrules["{ALLOW_EDIT_NO}"]        = "checked=\"checked\"";				$mrules["{ALLOW_ALL_EDIT_YES}"]   = "";				$mrules["{ALLOW_ALL_EDIT_NO}"]    = "checked=\"checked\"";				$mrules["{ALLOW_ADDST_YES}"]      = "";				$mrules["{ALLOW_ADDST_NO}"]       = "checked=\"checked\"";				$mrules["{MODERATIONST_YES}"]     = "";				$mrules["{MODERATIONST_NO}"]      = "checked=\"checked\"";				$mrules["{ALLOW_EDITST_YES}"] 	  = "";				$mrules["{ALLOW_EDITST_NO}"]      = "checked=\"checked\"";				$mrules["{ALLOW_ALL_EDITST_YES}"] = "";				$mrules["{ALLOW_ALL_EDITST_NO}"]  = "checked=\"checked\"";				$mrules["{ALLOW_ADDC_YES}"]       = "checked=\"checked\"";				$mrules["{ALLOW_ADDC_NO}"]        = "";				$mrules["{ALLOW_EDITC_YES}"]      = "";				$mrules["{ALLOW_EDITC_NO}"]       = "checked=\"checked\"";				$mrules["{ALLOW_DELC_YES}"]       = "";				$mrules["{ALLOW_DELC_NO}"]        = "checked=\"checked\"";				$mrules["{CAPTCHA_YES}"]          = "checked=\"checked\"";				$mrules["{CAPTCHA_NO}"]           = "";				$mrules["{EDIT_ALLC_YES}"]        = "";				$mrules["{EDIT_ALLC_NO}"]         = "checked=\"checked\"";				$mrules["{DEL_ALLC_YES}"]         = "";				$mrules["{DEL_ALLC_NO}"]          = "checked=\"checked\"";				$mrules["{ALLOW_HIDE_YES}"]       = "";				$mrules["{ALLOW_HIDE_NO}"]        = "checked=\"checked\"";				$mrules["{ALLOW_PM_YES}"]         = "checked=\"checked\"";				$mrules["{ALLOW_PM_NO}"]          = "";				$mrules["{ALLOW_SEARCH_YES}"]     = "checked=\"checked\"";				$mrules["{ALLOW_SEARCH_NO}"]      = "";				$mrules["{ALLOW_RATING_YES}"]     = "checked=\"checked\"";				$mrules["{ALLOW_RATING_NO}"]      = "";
				$mrules["{ALLOW_HTML_YES}"]       = "";				$mrules["{ALLOW_HTML_NO}"]        = "checked=\"checked\"";					 	        	$o_tpl->addhtml(ADMIN_TEMPLATES_DIR."/".$m."_form.tpl", $mrules);		    }	        else {							$group_name = stripslashes(htmlspecialchars(strip_tags($o_vars->post['group_name']), ENT_QUOTES));		     					if (@in_array("0", $o_vars->post['allow_cats'])) $allow_cats = "0";				else $allow_cats = @implode(",", $o_categories->makeCats($o_vars->post['allow_cats']));						if (@in_array("0", $o_vars->post['cat_add'])) $cat_add = "0";				else $cat_add = @implode(",", $o_categories->makeCats($o_vars->post['cat_add']));								$allow_offline    = intval($o_vars->post['allow_offline']);				$allow_admin 	  = intval($o_vars->post['allow_admin']);				$allow_short	  = intval($o_vars->post['allow_short']);				$allow_poll		  = intval($o_vars->post['allow_poll']);				$allow_adds 	  = intval($o_vars->post['allow_adds']);				$moderation 	  = intval($o_vars->post['moderation']);				$allow_main 	  = intval($o_vars->post['allow_main']);				$allow_edit 	  = intval($o_vars->post['allow_edit']);				$allow_all_edit	  = intval($o_vars->post['allow_all_edit']);				$allow_addst 	  = intval($o_vars->post['allow_addst']);				$moderationst 	  = intval($o_vars->post['moderationst']);				$allow_editst 	  = intval($o_vars->post['allow_editst']);				$allow_all_editst = intval($o_vars->post['allow_all_editst']);				$allow_addc 	  = intval($o_vars->post['allow_addc']);				$allow_editc 	  = intval($o_vars->post['allow_editc']);				$allow_delc 	  = intval($o_vars->post['allow_delc']);				$captcha		  = intval($o_vars->post['captcha']);				$edit_allc 		  = intval($o_vars->post['edit_allc']);				$del_allc 		  = intval($o_vars->post['del_allc']);				$allow_hide		  = intval($o_vars->post['allow_hide']);				$allow_pm		  = intval($o_vars->post['allow_pm']);				$allow_search	  = intval($o_vars->post['allow_search']);				$allow_rating	  = intval($o_vars->post['allow_rating']);
				$allow_html	      = intval($o_vars->post['allow_html']);				            				if ($group_name!="" && !$o_usersgroup->valueExists("group_name", $group_name)) {
				
					$sw = true;
										$result = $o_usersgroup->add($group_name, $allow_cats, $cat_add, $allow_offline, $allow_admin, $allow_short, $allow_poll, $allow_adds, $moderation, $allow_main, $allow_edit, $allow_all_edit, $allow_addc, $allow_editc, $allow_delc, $captcha, $edit_allc, $del_allc, $allow_hide, $allow_pm, $allow_search, $allow_rating, $allow_addst, $allow_editst, $allow_all_editst, $moderationst, $allow_html);
						            	if ($result) $MESS = $o_other->showMessA($LANG[$m.'_add']);
	            	else $MESS = $o_other->showMessA($LANG[$m.'_eadd'], 1);
	            }	            else {
	            	
	            	$mrules["{TITLEE}"] = $LANG[$m.'_fadd'];				
					$mrules["{GROUP_NAME}"] = $group_name;
					$mrules["{IS_ADM}"]     = "";
					
					$cats1 = array();					$cats1 = explode(",", $allow_cats);	    			if ($allow_cats=="0") {$mrules["{ALLOW_CATS_SEL}"] = "selected=\"selected\""; $cats1 = "";}	    			else $mrules["{ALLOW_CATS_SEL}"] = "";					
					$mrules["{ALLOW_CATS}"] = "";
					
					$result = $o_categories->makeTree();
					if ($result) foreach ($result as $n1) 						$mrules["{ALLOW_CATS}"] .= (@in_array($n1[0], $cats1)) ? "<option value=\"$n1[0]\" selected=\"selected\">".$n1[1]."</option>" : "<option value=\"$n1[0]\">".$n1[1]."</option>";
					
					$cats1 = array();					$cats1 = explode(",", $cat_add);	    			if ($cat_add=="0") {$mrules["{CAT_ADD_SEL}"] = "selected=\"selected\""; $cats1 = "";}	    			else $mrules["{CAT_ADD_SEL}"] = "";					
					$mrules["{CAT_ADD_CATS}"] = "";
					
					$result = $o_categories->makeTree();
					if ($result) foreach ($result as $n1) 						$mrules["{CAT_ADD}"] .= (@in_array($n1[0], $cats1)) ? "<option value=\"$n1[0]\" selected=\"selected\">".$n1[1]."</option>" : "<option value=\"$n1[0]\">".$n1[1]."</option>";	
					
					$mrules["{ALLOW_OFFLINE_YES}"]    = ($allow_offline)   	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_OFFLINE_NO}"]     = (!$allow_offline) 	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ADMIN_YES}"]      = ($allow_admin)  	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ADMIN_NO}"]       = (!$allow_admin) 	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_SHORT_YES}"]      = ($allow_short)  	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_SHORT_NO}"]       = (!$allow_short) 	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_POLL_YES}"]       = ($allow_poll)  		 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_POLL_NO}"]        = (!$allow_poll) 		 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ADDS_YES}"]       = ($allow_adds)  		 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ADDS_NO}"]        = (!$allow_adds) 		 ? "checked=\"checked\"" : "";					$mrules["{MODERATION_YES}"]       = ($moderation)  		 ? "checked=\"checked\"" : "";					$mrules["{MODERATION_NO}"]        = (!$moderation) 		 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_MAIN_YES}"]       = ($allow_main) 		 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_MAIN_NO}"]        = (!$allow_main)		 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_EDIT_YES}"] 	  = ($allow_edit) 		 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_EDIT_NO}"]        = (!$allow_edit)		 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ALL_EDIT_YES}"]   = ($allow_all_edit) 	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ALL_EDIT_NO}"]    = (!$allow_all_edit)	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ADDST_YES}"]      = ($allow_addst) 		 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ADDST_NO}"]       = (!$allow_addst)		 ? "checked=\"checked\"" : "";					$mrules["{MODERATIONST_YES}"]     = ($moderationst) 	 ? "checked=\"checked\"" : "";					$mrules["{MODERATIONST_NO}"]      = (!$moderationst)	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_EDITST_YES}"] 	  = ($allow_editst) 	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_EDITST_NO}"]      = (!$allow_editst)	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ALL_EDITST_YES}"] = ($allow_all_editst)  ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ALL_EDITST_NO}"]  = (!$allow_all_editst) ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ADDC_YES}"]       = ($allow_addc)   	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ADDC_NO}"]        = (!$allow_addc) 		 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_EDITC_YES}"]      = ($allow_editc)  	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_EDITC_NO}"]       = (!$allow_editc) 	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_DELC_YES}"]       = ($allow_delc)  		 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_DELC_NO}"]        = (!$allow_delc) 		 ? "checked=\"checked\"" : "";					$mrules["{CAPTCHA_YES}"]          = ($captcha)  		 ? "checked=\"checked\"" : "";					$mrules["{CAPTCHA_NO}"]           = (!$captcha) 		 ? "checked=\"checked\"" : "";					$mrules["{EDIT_ALLC_YES}"]        = ($edit_allc)  		 ? "checked=\"checked\"" : "";					$mrules["{EDIT_ALLC_NO}"]         = (!$edit_allc) 		 ? "checked=\"checked\"" : "";					$mrules["{DEL_ALLC_YES}"]         = ($del_allc) 		 ? "checked=\"checked\"" : "";					$mrules["{DEL_ALLC_NO}"]          = (!$del_allc)		 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_HIDE_YES}"]       = ($allow_hide)  		 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_HIDE_NO}"]        = (!$allow_hide)		 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_PM_YES}"]         = ($allow_pm)     	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_PM_NO}"]          = (!$allow_pm)    	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_SEARCH_YES}"]     = ($allow_search) 	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_SEARCH_NO}"]      = (!$allow_search)	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_RATING_YES}"]     = ($allow_rating) 	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_RATING_NO}"]      = (!$allow_rating)	 ? "checked=\"checked\"" : "";
					$mrules["{ALLOW_HTML_YES}"]       = ($allow_html) 	     ? "checked=\"checked\"" : "";					$mrules["{ALLOW_HTML_NO}"]        = (!$allow_html)	     ? "checked=\"checked\"" : "";						
					
	            	$o_tpl->addhtml(ADMIN_TEMPLATES_DIR."/".$m."_form.tpl", $mrules);
	            	$MESS = $o_other->showMessA($LANG['wrong_input']. $LANG[$m.'_eform'], 1);
	            }	    	}	    }
	    elseif ($a=="edit" && isset($id)) {
	    
	    	$sw = false;		    			$action = $o_vars->post['action'];				        if (!isset($action)) {	            $result = $o_usersgroup->get($id);	            if (!$result) {$sw = true; $MESS = $o_other->showMessA($LANG[$m.'_eget'], 1);}				else {		        	foreach ($result as $n);
		        	
		        	$mrules["{TITLEE}"] = $LANG[$m.'_fedit']. $n[1];		        						$mrules["{GROUP_NAME}"] = $n[1];															$mrules["{ALLOW_OFFLINE_YES}"]    = ($n[4])   ? "checked=\"checked\"" : "";					$mrules["{ALLOW_OFFLINE_NO}"]     = (!$n[4])  ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ADMIN_YES}"]      = ($n[5])   ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ADMIN_NO}"]       = (!$n[5])  ? "checked=\"checked\"" : "";					$mrules["{ALLOW_SHORT_YES}"]      = ($n[6])   ? "checked=\"checked\"" : "";					$mrules["{ALLOW_SHORT_NO}"]       = (!$n[6])  ? "checked=\"checked\"" : "";					$mrules["{ALLOW_POLL_YES}"]       = ($n[7])   ? "checked=\"checked\"" : "";					$mrules["{ALLOW_POLL_NO}"]        = (!$n[7])  ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ADDS_YES}"]       = ($n[8])   ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ADDS_NO}"]        = (!$n[8])  ? "checked=\"checked\"" : "";					$mrules["{MODERATION_YES}"]       = ($n[9])   ? "checked=\"checked\"" : "";					$mrules["{MODERATION_NO}"]        = (!$n[9])  ? "checked=\"checked\"" : "";					$mrules["{ALLOW_MAIN_YES}"]       = ($n[10])  ? "checked=\"checked\"" : "";					$mrules["{ALLOW_MAIN_NO}"]        = (!$n[10]) ? "checked=\"checked\"" : "";					$mrules["{ALLOW_EDIT_YES}"] 	  = ($n[11])  ? "checked=\"checked\"" : "";					$mrules["{ALLOW_EDIT_NO}"]        = (!$n[11]) ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ALL_EDIT_YES}"]   = ($n[12])  ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ALL_EDIT_NO}"]    = (!$n[12]) ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ADDST_YES}"]      = ($n[23])  ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ADDST_NO}"]       = (!$n[23]) ? "checked=\"checked\"" : "";					$mrules["{MODERATIONST_YES}"]     = ($n[26])  ? "checked=\"checked\"" : "";					$mrules["{MODERATIONST_NO}"]      = (!$n[26]) ? "checked=\"checked\"" : "";					$mrules["{ALLOW_EDITST_YES}"] 	  = ($n[24])  ? "checked=\"checked\"" : "";					$mrules["{ALLOW_EDITST_NO}"]      = (!$n[24]) ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ALL_EDITST_YES}"] = ($n[25])  ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ALL_EDITST_NO}"]  = (!$n[25]) ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ADDC_YES}"]       = ($n[13])  ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ADDC_NO}"]        = (!$n[13]) ? "checked=\"checked\"" : "";					$mrules["{ALLOW_EDITC_YES}"]      = ($n[14])  ? "checked=\"checked\"" : "";					$mrules["{ALLOW_EDITC_NO}"]       = (!$n[14]) ? "checked=\"checked\"" : "";					$mrules["{ALLOW_DELC_YES}"]       = ($n[15])  ? "checked=\"checked\"" : "";					$mrules["{ALLOW_DELC_NO}"]        = (!$n[15]) ? "checked=\"checked\"" : "";					$mrules["{CAPTCHA_YES}"]          = ($n[16])  ? "checked=\"checked\"" : "";					$mrules["{CAPTCHA_NO}"]           = (!$n[16]) ? "checked=\"checked\"" : "";					$mrules["{EDIT_ALLC_YES}"]        = ($n[17])  ? "checked=\"checked\"" : "";					$mrules["{EDIT_ALLC_NO}"]         = (!$n[17]) ? "checked=\"checked\"" : "";					$mrules["{DEL_ALLC_YES}"]         = ($n[18])  ? "checked=\"checked\"" : "";					$mrules["{DEL_ALLC_NO}"]          = (!$n[18]) ? "checked=\"checked\"" : "";					$mrules["{ALLOW_HIDE_YES}"]       = ($n[19])  ? "checked=\"checked\"" : "";					$mrules["{ALLOW_HIDE_NO}"]        = (!$n[19]) ? "checked=\"checked\"" : "";					$mrules["{ALLOW_PM_YES}"]         = ($n[20])  ? "checked=\"checked\"" : "";					$mrules["{ALLOW_PM_NO}"]          = (!$n[20]) ? "checked=\"checked\"" : "";					$mrules["{ALLOW_SEARCH_YES}"]     = ($n[21])  ? "checked=\"checked\"" : "";					$mrules["{ALLOW_SEARCH_NO}"]      = (!$n[21]) ? "checked=\"checked\"" : "";					$mrules["{ALLOW_RATING_YES}"]     = ($n[22])  ? "checked=\"checked\"" : "";					$mrules["{ALLOW_RATING_NO}"]      = (!$n[22]) ? "checked=\"checked\"" : "";
					$mrules["{ALLOW_HTML_YES}"]       = ($n[27])  ? "checked=\"checked\"" : "";					$mrules["{ALLOW_HTML_NO}"]        = (!$n[27]) ? "checked=\"checked\"" : "";										$mrules["{IS_ADM}"] = ($id==1) ? "disabled=\"disabled\"" : "";										$allow_cats = array();					$allow_cats = explode(",", $n[2]);					
					$cat_add = array();					$cat_add = explode(",", $n[3]);					
					if ($n[2]=="0") {$mrules["{ALLOW_CATS_SEL}"] = "selected=\"selected\""; $allow_cats = "";}	    			else $mrules["{ALLOW_CATS_SEL}"] = "";					
					if ($n[3]=="0") {$mrules["{CAT_ADD_SEL}"] = "selected=\"selected\""; $cat_add = "";}	    			else $mrules["{CAT_ADD_SEL}"] = "";	    			
	    			$mrules["{ALLOW_CATS}"] = "";
	    			$mrules["{CAT_ADD}"]    = "";
	    								$result = $o_categories->makeTree();	    			if ($result) 
	    				foreach ($result as $n1) {							$mrules["{ALLOW_CATS}"] .= (@in_array($n1[0], $allow_cats)) ? "<option value=\"$n1[0]\" selected=\"selected\">".$n1[1]."</option>" : "<option value=\"$n1[0]\">".$n1[1]."</option>";							$mrules["{CAT_ADD}"] .= (@in_array($n1[0], $cat_add))       ? "<option value=\"$n1[0]\" selected=\"selected\">".$n1[1]."</option>" : "<option value=\"$n1[0]\">".$n1[1]."</option>";						}																$o_tpl->addhtml(ADMIN_TEMPLATES_DIR."/".$m."_form.tpl", $mrules);	            }	        } 			else {								$group_name = stripslashes(htmlspecialchars(strip_tags($o_vars->post['group_name'])));										if (@in_array("0", $o_vars->post['allow_cats']) || $id==1) $allow_cats = "0";				else $allow_cats = @implode(",", $o_categories->makeCats($o_vars->post['allow_cats']));								if (@in_array("0", $o_vars->post['cat_add']) || $id==1) $cat_add = "0";				else $cat_add = @implode(",", $o_categories->makeCats($o_vars->post['cat_add']));								$allow_offline 	  = intval($o_vars->post['allow_offline']);				$allow_admin 	  = intval($o_vars->post['allow_admin']);				$allow_short	  = intval($o_vars->post['allow_short']);				$allow_poll		  = intval($o_vars->post['allow_poll']);				$allow_adds       = intval($o_vars->post['allow_adds']);				$moderation 	  = intval($o_vars->post['moderation']);				$allow_main 	  = intval($o_vars->post['allow_main']);				$allow_edit 	  = intval($o_vars->post['allow_edit']);				$allow_all_edit	  = intval($o_vars->post['allow_all_edit']);				$allow_addst 	  = intval($o_vars->post['allow_addst']);				$moderationst 	  = intval($o_vars->post['moderationst']);				$allow_editst 	  = intval($o_vars->post['allow_editst']);				$allow_all_editst = intval($o_vars->post['allow_all_editst']);				$allow_addc 	  = intval($o_vars->post['allow_addc']);				$allow_editc 	  = intval($o_vars->post['allow_editc']);				$allow_delc 	  = intval($o_vars->post['allow_delc']);				$captcha		  = intval($o_vars->post['captcha']);				$edit_allc 		  = intval($o_vars->post['edit_allc']);				$del_allc 		  = intval($o_vars->post['del_allc']);				$allow_hide		  = intval($o_vars->post['allow_hide']);				$allow_pm		  = intval($o_vars->post['allow_pm']);				$allow_search	  = intval($o_vars->post['allow_search']);				$allow_rating	  = intval($o_vars->post['allow_rating']);	        	$allow_html	      = intval($o_vars->post['allow_html']);	        		        					if ($group_name!="" && $id!="" && !$o_usersgroup->valueExists("group_name", $group_name, $id)) {
				
					$sw = true;
										$result = $o_usersgroup->update($id, $group_name, $allow_cats, $cat_add, $allow_offline, $allow_admin, $allow_short, $allow_poll, $allow_adds, $moderation, $allow_main, $allow_edit, $allow_all_edit, $allow_addc, $allow_editc, $allow_delc, $captcha, $edit_allc, $del_allc, $allow_hide, $allow_pm, $allow_search, $allow_rating, $allow_addst, $allow_editst, $allow_all_editst, $moderationst, $allow_html);	            	
	            	if ($result) $MESS = $o_other->showMessA($LANG[$m.'_edit']);
	            	else $MESS = $o_other->showMessA($LANG[$m.'_eedit'], 1); 	
	            }	        	else {
	        		
	        		$mrules["{TITLEE}"] = $LANG[$m.'_fedit']. $o_usersgroup->getOne($id, "group_name");
	        		
	        		$mrules["{GROUP_NAME}"] = $group_name;
					$mrules["{IS_ADM}"] = ($id==1) ? "disabled=\"disabled\"" : "";
					
					$cats1 = array();					$cats1 = explode(",", $allow_cats);	    			if ($allow_cats=="0") {$mrules["{ALLOW_CATS_SEL}"] = "selected=\"selected\""; $cats1 = "";}	    			else $mrules["{ALLOW_CATS_SEL}"] = "";					
					$mrules["{ALLOW_CATS}"] = "";
					
					$result = $o_categories->makeTree();
					if ($result) foreach ($result as $n1) 						$mrules["{ALLOW_CATS}"] .= (@in_array($n1[0], $cats1)) ? "<option value=\"$n1[0]\" selected=\"selected\">".$n1[1]."</option>" : "<option value=\"$n1[0]\">".$n1[1]."</option>";
					
					$cats1 = array();					$cats1 = explode(",", $cat_add);	    			if ($cat_add=="0") {$mrules["{CAT_ADD_SEL}"] = "selected=\"selected\""; $cats1 = "";}	    			else $mrules["{CAT_ADD_SEL}"] = "";					
					$mrules["{CAT_ADD_CATS}"] = "";
					
					$result = $o_categories->makeTree();
					if ($result) foreach ($result as $n1) 						$mrules["{CAT_ADD}"] .= (@in_array($n1[0], $cats1)) ? "<option value=\"$n1[0]\" selected=\"selected\">".$n1[1]."</option>" : "<option value=\"$n1[0]\">".$n1[1]."</option>";	
					
					$mrules["{ALLOW_OFFLINE_YES}"]    = ($allow_offline)   	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_OFFLINE_NO}"]     = (!$allow_offline) 	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ADMIN_YES}"]      = ($allow_admin)  	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ADMIN_NO}"]       = (!$allow_admin) 	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_SHORT_YES}"]      = ($allow_short)  	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_SHORT_NO}"]       = (!$allow_short) 	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_POLL_YES}"]       = ($allow_poll)  		 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_POLL_NO}"]        = (!$allow_poll) 		 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ADDS_YES}"]       = ($allow_adds)  		 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ADDS_NO}"]        = (!$allow_adds) 		 ? "checked=\"checked\"" : "";					$mrules["{MODERATION_YES}"]       = ($moderation)  		 ? "checked=\"checked\"" : "";					$mrules["{MODERATION_NO}"]        = (!$moderation) 		 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_MAIN_YES}"]       = ($allow_main) 		 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_MAIN_NO}"]        = (!$allow_main)		 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_EDIT_YES}"] 	  = ($allow_edit) 		 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_EDIT_NO}"]        = (!$allow_edit)		 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ALL_EDIT_YES}"]   = ($allow_all_edit) 	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ALL_EDIT_NO}"]    = (!$allow_all_edit)	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ADDST_YES}"]      = ($allow_addst) 		 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ADDST_NO}"]       = (!$allow_addst)		 ? "checked=\"checked\"" : "";					$mrules["{MODERATIONST_YES}"]     = ($moderationst) 	 ? "checked=\"checked\"" : "";					$mrules["{MODERATIONST_NO}"]      = (!$moderationst)	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_EDITST_YES}"] 	  = ($allow_editst) 	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_EDITST_NO}"]      = (!$allow_editst)	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ALL_EDITST_YES}"] = ($allow_all_editst)  ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ALL_EDITST_NO}"]  = (!$allow_all_editst) ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ADDC_YES}"]       = ($allow_addc)   	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_ADDC_NO}"]        = (!$allow_addc) 		 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_EDITC_YES}"]      = ($allow_editc)  	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_EDITC_NO}"]       = (!$allow_editc) 	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_DELC_YES}"]       = ($allow_delc)  		 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_DELC_NO}"]        = (!$allow_delc) 		 ? "checked=\"checked\"" : "";					$mrules["{CAPTCHA_YES}"]          = ($captcha)  		 ? "checked=\"checked\"" : "";					$mrules["{CAPTCHA_NO}"]           = (!$captcha) 		 ? "checked=\"checked\"" : "";					$mrules["{EDIT_ALLC_YES}"]        = ($edit_allc)  		 ? "checked=\"checked\"" : "";					$mrules["{EDIT_ALLC_NO}"]         = (!$edit_allc) 		 ? "checked=\"checked\"" : "";					$mrules["{DEL_ALLC_YES}"]         = ($del_allc) 		 ? "checked=\"checked\"" : "";					$mrules["{DEL_ALLC_NO}"]          = (!$del_allc)		 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_HIDE_YES}"]       = ($allow_hide)  		 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_HIDE_NO}"]        = (!$allow_hide)		 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_PM_YES}"]         = ($allow_pm)     	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_PM_NO}"]          = (!$allow_pm)    	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_SEARCH_YES}"]     = ($allow_search) 	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_SEARCH_NO}"]      = (!$allow_search)	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_RATING_YES}"]     = ($allow_rating) 	 ? "checked=\"checked\"" : "";					$mrules["{ALLOW_RATING_NO}"]      = (!$allow_rating)	 ? "checked=\"checked\"" : "";						
					$mrules["{ALLOW_HTML_YES}"]       = ($allow_html) 	     ? "checked=\"checked\"" : "";					$mrules["{ALLOW_HTML_NO}"]        = (!$allow_html)	     ? "checked=\"checked\"" : "";
					
	            	$o_tpl->addhtml(ADMIN_TEMPLATES_DIR."/".$m."_form.tpl", $mrules);
	            	$MESS = $o_other->showMessA($LANG['wrong_input']. $LANG[$m.'_eform'], 1);
	        	}			}	    }	    
	    if ((!isset($a) && !isset($id)) || ($a=="del" && isset($id))  || ($a=="add" && $sw) || ($a=="edit" && isset($id) && $sw)) {	    	
	    	if ($a=="del") {
				if ($id==1) $MESS = $o_other->showMessA($LANG[$m.'_edel'], 1);				else {
								$result = $o_usersgroup->del($id); 			    	
			    	if ($result) $MESS = $o_other->showMessA($LANG[$m.'_del']);			        else $MESS = $o_other->showMessA($LANG[$m.'_edel'], 1);				}
	    	}
	    		    	$action = $o_vars->post['action'];	    		    	if (isset($action) && $a!="add" && $a!="edit") {					$make     = $o_vars->post['make'];				$selected = $o_vars->post['selected'];								$result = $o_usersgroup->makeIn($make, $selected);				
				if ($result) $MESS = $o_other->showMessA($LANG[$m.'_make']);	            else $MESS = $o_other->showMessA($LANG[$m.'_emake'], 1); 
			}						$result = $o_usersgroup->get();	        $o_tpl->addhtml(ADMIN_TEMPLATES_DIR."/".$m."_allshowt.tpl");			if (!$result) $o_tpl->addhtml("<div class=\"nothing\">".$LANG[$m.'_egets']."</div>");	        else {	        	foreach ($result as $n) {
	        			            $mrules["{ID}"]         = $n[0];		            $mrules["{GROUP_NAME}"] = $n[1];		            $mrules["{KOL}"]        = $o_usersgroup->kolGroupUsers($n[0]);	                					$o_tpl->addhtml(ADMIN_TEMPLATES_DIR."/".$m."_allshowm.tpl", $mrules);	            }	        }	        $o_tpl->addhtml(ADMIN_TEMPLATES_DIR."/".$m."_allshowb.tpl");		}		elseif ($a!="add" && ($a!="edit" || ($a=="edit" && !isset($id)))) $MESS1 = $o_other->showMessA($LANG['efunction'], 1);	}	else $MESS1 = $o_other->showMessA($LANG['eaccess'], 1);	        ?>
